# .github/workflows/free-data-pipeline.yml
name: Free Real Estate Data Pipeline

on:
  schedule:
    - cron: "0 */6 * * *"
  workflow_dispatch:
  push:
    branches: [main]

jobs:
  run-pipeline:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        pip install requests beautifulsoup4 pandas numpy
        echo "Dependencies installed"
    
    - name: Create directories
      run: |
        mkdir -p scripts
        mkdir -p data/houston-county-ga/31088
        mkdir -p data/houston-county-ga/31093
        mkdir -p data/houston-county-ga/31098
    
    - name: Run data collection
      run: |
        echo "Running data collection..."
        if [ -f "scripts/free_data_collector.py" ]; then
          python scripts/free_data_collector.py --all
        else
          echo "Error: free_data_collector.py not found"
          exit 1
        fi
    
    - name: Create dashboard
      run: |
        echo "Creating dashboard..."
        if [ -f "scripts/create_dashboard_json.py" ]; then
          python scripts/create_dashboard_json.py
        else
          echo "create_dashboard_json.py not found, skipping"
        fi
    
    - name: List output files
      run: |
        echo "Generated files:"
        find data/houston-county-ga -name "*.json" | head -20
