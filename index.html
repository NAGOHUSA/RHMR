<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Houston County Market Dashboard</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <h1>Houston County Real Estate Dashboard</h1>
    <div>
      <label for="zipSelect">Select ZIP:</label>
      <select id="zipSelect"></select>
    </div>
  </header>

  <main>
    <section id="metrics">
      <h2>Market Metrics</h2>
      <div class="metric-container">
        <div class="metric">
          <h3>Median List Price</h3>
          <p id="medianList">$0 <span id="medianListArrow"></span></p>
        </div>
        <div class="metric">
          <h3>Median Sale Price</h3>
          <p id="medianSale">$0 <span id="medianSaleArrow"></span></p>
        </div>
        <div class="metric">
          <h3>Inventory</h3>
          <p id="inventory">0 <span id="inventoryArrow"></span></p>
        </div>
        <div class="metric">
          <h3>Trend</h3>
          <p id="trend">N/A</p>
        </div>
      </div>
    </section>

    <section id="charts">
      <h2>Trends</h2>
      <canvas id="priceChart" width="600" height="250"></canvas>
      <canvas id="inventoryChart" width="600" height="250"></canvas>
    </section>

    <section id="insights">
      <h2>Weekly Insights</h2>
      <div id="insightsList" class="insight-cards"></div>
    </section>
  </main>

  <script src="charts.js"></script>
  <script>
    const zipSelect = document.getElementById("zipSelect");
    let allData = {};

    async function loadDataJSON() {
      try {
        const response = await fetch('data/houston-county-ga/market_all_zips.json');
        allData = await response.json();

        // Populate ZIP dropdown
        zipSelect.innerHTML = '';
        Object.keys(allData).forEach(zip => {
          const option = document.createElement('option');
          option.value = zip;
          option.innerText = `${zip} - ${allData[zip].city}`;
          zipSelect.appendChild(option);
        });

        loadZIP(zipSelect.value);

      } catch (err) {
        console.error("Failed to load market JSON:", err);
      }
    }

    function setArrow(elementId, change) {
      const el = document.getElementById(elementId);
      if (change > 0) el.innerHTML = '<span class="arrow up">⬆️</span>';
      else if (change < 0) el.innerHTML = '<span class="arrow down">⬇️</span>';
      else el.innerHTML = '<span class="arrow flat">➡️</span>';
    }

    function loadZIP(zip) {
      const data = allData[zip];
      if (!data) return;

      // Metrics
      const lastListChange = data.history.median_list.slice(-1)[0] - data.history.median_list.slice(-2)[0];
      document.getElementById("medianList").innerText = `$${data.pricing.median_list.toLocaleString()}`;
      setArrow("medianListArrow", lastListChange);

      const lastSaleChange = data.history.median_sale ? data.history.median_sale.slice(-1)[0] - data.history.median_sale.slice(-2)[0] : 0;
      document.getElementById("medianSale").innerText = `$${data.pricing.median_sale.toLocaleString()}`;
      setArrow("medianSaleArrow", lastSaleChange);

      const lastInventoryChange = data.history.inventory ? data.history.inventory.slice(-1)[0] - data.history.inventory.slice(-2)[0] : 0;
      document.getElementById("inventory").innerText = data.inventory.active.toLocaleString();
      setArrow("inventoryArrow", lastInventoryChange);

      document.getElementById("trend").innerText = data.pricing.trend;

      // Insights
      const insightsDiv = document.getElementById("insightsList");
      insightsDiv.innerHTML = '';
      data.weekly_insights.forEach(point => {
        const card = document.createElement("div");
        card.className = "insight-card";
        card.innerText = point.text;
        if(point.type === 'positive') card.classList.add('positive');
        else if(point.type === 'negative') card.
